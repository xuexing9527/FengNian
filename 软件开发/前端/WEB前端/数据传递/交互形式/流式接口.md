# 流式接口

## 传统接口与流式接口

**传统接口**

Request / Response 模式
在互联网系统里，接口的工作方式非常直白：
客户端发请求 → 服务器处理 → 一次性返回完整结果

例如：
```
查询用户信息 ---> 获取商品列表 ---> 提交订单
```

特点：
简单、易理解、易调试

但有一个天然限制：
**必须等服务器“全部处理完”才能返回。**

随着业务复杂化，出现了三类新场景：

### 1. 结果生成时间长

- 比如 AI 生成文本

- 数据分析报表计算

- 视频转码

### 2. 结果本身很大

- 大文件下载

- 日志流

- 实时行情数据

### 3. 结果本质是“持续变化的”

- 股票行情

- 传感器数据

- 在线聊天消息

这时候“一次性返回完整结果”就开始变得别扭：

用户在等，前端没有反馈，服务器连接长时间占用，用户体验差。

于是：
**“能不能先返回一部分？后面再一点点补上？”**

流式接口（Streaming API）

服务器在数据产生的同时，就立刻把已产生的部分发送给客户端，而不是等全部完成后一次性返回。

流式接口解决的问题：

| 问题    | 传统接口  | 流式接口     |
| ----- | ----- | -------- |
| 长任务等待 | 必须等完成 | 立刻有反馈    |
| 大数据传输 | 一次性大包 | 分段小包     |
| 实时数据  | 频繁轮询  | 持续推送     |
| 连接资源  | 长时间阻塞 | 可持续占用但高效 |

## 流式接口的实现

1. Chunked HTTP  
HTTP 1.1 支持，不提前声明内容长度，服务器可以一块一块发。

2. Server-Sent Events (SSE)  

    特点：  
    - 单向：服务器 → 客户端

    - 基于普通 HTTP

    - 自动重连  

    常用于，股票行情、AI 文本流式输出、日志推送
3. WebSocket

4. gRPC Streaming